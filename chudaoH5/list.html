<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <meta name="keywords" content="列表,关键字" />
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta name="format-detection" content="telephone=yes" />
    <meta http-equiv="x-rim-auto-match" content="none">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <script type="text/javascript" src="./js/flexible.js"></script>
    <link type="text/css" rel="stylesheet" href="./css/base.css">
    <link type="text/css" rel="stylesheet" href="./css/dropload.css">
    <title>列表记录</title>
    <style>
        html, body {
            height: 100vh;
            background:#f8f8f8;
        }
        .item-section{background:#f8f8f8;}
        .tith3{
            display: block;font-size: .426667rem;color: #333;line-height: .8rem;
        }
        .repair_ul{
            padding:.213333rem 0 0;
        }
        .repair_li{
            position: relative;padding: .4rem .533333rem .266667rem; background: #fff;font-size: .373333rem;margin-bottom: .213333rem;
        }
        .repair_li .flex1{ overflow: hidden;}
        .p14{
            font-size: .373333rem;
        }
        .bt_info{
            line-height: .666667rem;color: #8c8c92;
        }
        .notips{
            color: #8c8c92;font-size: .346667rem;text-align: center;margin: .533333rem auto 0;line-height: .666667rem;
        }


    </style>


</head>
<body >
<section class="item-section">
    <div id="header" class="header topbar" >
        <div class="headbar topbar">
            <div class="top_info" onclick="gobackTap()" >
                <img src="./images/goback.png" alt="" class="goback_icon" />
            </div>
            <div class="top_title" >
                <div class="h1title">记录列表</div>
            </div>
        </div>

    </div>
    <div class="mianbox">
            <ul class="repair_ul" data-index="0">
                <li class="repair_li flexbox" >
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-101</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/01</p>
                        </div>
                    </div>
                </li>
                <li class="repair_li flexbox">
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-102</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/02</p>
                        </div>
                    </div>
                </li>
                <li class="repair_li flexbox">
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-103</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/03</p>
                        </div>
                    </div>
                </li>
                <li class="repair_li flexbox">
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-104</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/04</p>
                        </div>
                    </div>
                </li>
                <li class="repair_li flexbox">
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-105</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/05</p>
                        </div>
                    </div>
                </li>
                <li class="repair_li flexbox">
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-106</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/06</p>
                        </div>
                    </div>
                </li>
                <li class="repair_li flexbox">
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-107</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/07</p>
                        </div>
                    </div>
                </li>
                <li class="repair_li flexbox">
                    <div class="flex1">
                        <h3 class="tith3">青年公寓-108</h3>
                        <div class="bt_info p14">
                            <p class="text-overflow">某事罚款司法考试经典款</p>
                            <p>2019/03/08</p>
                        </div>
                    </div>
                </li>


            </ul>

    </div>


    <div id="domediv" class="divh1 center none"></div>
</section>
<div class="ajax_tip"></div>

<script type="text/javascript" src="./js/jweixin-1.3.2.js"></script>
<script type="text/javascript" src="./js/zepto.min.js"></script>
<script type="text/javascript" src="./js/index.js"></script>
<script type="text/javascript" src="./js/dropload.min.js"></script>
<script>
var acesToken, uid, rqhead;
var version = null;

if(getPram('uid')){ //小程序获取token
    acesToken = getPram('token')?getPram('token'):'';
    uid = getPram('uid')?getPram('uid'):'';
    rqhead = {
        'Access-Token': 'APP-' + acesToken, 'User-Id': uid
    };
    //$("#domediv").html('rqhead=小程序='+JSON.stringify(rqhead));
}

// 微信小程序中，是否显示头部
function ready() {
    var version = getPram("version")? getPram("version"): '';
    if (version < 0) {
        document.querySelector('#header').style.display = "block";
    }else{
        document.querySelector('#header').style.display = "none";
    }
 console.log(window.__wxjs_environment, version)
}
if (!window.WeixinJSBridge || !WeixinJSBridge.invoke) {
  document.addEventListener('WeixinJSBridgeReady', ready, false)
} else {
  ready()
}

window.onload = function() {
    if (uid ==''&& !version) {
        if (!isAndroid) {
            //iOS获取token
            setupWebViewJavascriptBridge(function (bridge) {
                bridge.callHandler("getUserData", function (response) {
                    acesToken = response.token;
                    uid = response.userId;
                    rqhead = {
                        'Access-Token': 'APP-' + acesToken, 'User-Id': uid
                    };
                    //$("#domediv").html('rqhead=IOS='+JSON.stringify(rqhead));
                })
            })
        } else {
            //安卓获取token
            if(uid ==''){
                var infodata = window.DataAnalysis.getAppInfo();
                infodata = JSON.parse(infodata);
                acesToken = infodata.token;
                uid = infodata.id;
                rqhead = {
                    'Access-Token': 'APP-' + acesToken, 'User-Id': uid
                };
            }
            //$("#domediv").html('rqhead=安卓='+JSON.stringify(rqhead));
        }
    }
};


sessionStorage.setItem("uid", uid);sessionStorage.setItem("acesToken", acesToken);

    setTimeout(function() {
        var dropload = $('.mianbox').dropload({
            scrollArea: window,
            domDown : { // 下方DOM
            domClass : 'dropload-down',
                domLoad : '<div class="dropload-load"><span class="loading"></span>加载中...</div>',
                domNoData : '<div class="dropload-noData">已加载了全部数据~</div>'
            },
            loadDownFn: function (me) {
                var result = '';
                for (var i = 1; i < 9; i++) {
                    result += `<li class="repair_li flexbox">
                        <div class="flex1">
                            <h3 class="tith3">青年公寓-`+(1+i)+'0'+i+`</h3>
                            <div class="bt_info p14">
                                <p class="text-overflow">某事罚款司法考试经典款</p>
                                <p>2019/04/0`+i+`</p>
                            </div>
                        </div>
                    </li>`;

                }

                $('.repair_ul').append(result);
                // 每次数据加载完，必须重置
                me.resetload();

            }
        });
    }, 200);

//返回原生页(goBack--原生方法名，DataAnalysis安卓约定参数)
function gobackTap() {
    if (!window.WeixinJSBridge || !WeixinJSBridge.invoke) {
        if (!isAndroid) {
            //showError('苹果端');
            setupWebViewJavascriptBridge(function (bridge) {
                bridge.callHandler("goBack", '0', function (response) {
                    //showError('返回')
                })
            })
        } else {
            //showError('安卓端');
            window.DataAnalysis.goBack();
        }
    } else {
        //showError('小程序');
        wx.miniProgram.navigateBack({ delta: 1})
    }
}



</script>
</body>
</html>